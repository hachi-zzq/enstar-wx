var _prototypeProperties=function(e,t,a){t&&Object.defineProperties(e,t),a&&Object.defineProperties(e.prototype,a)},_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};!function(e,t,a,i,n){"use strict";function r(e){for(var t=arguments.length,a=Array(t>1?t-1:0),i=1;t>i;i++)a[i-1]=arguments[i];if(e)for(var n in a)for(var r in a[n])a[n].hasOwnProperty(r)&&(e[r]=a[n][r]);return e}function s(e,t,a){(a||!c(e,t))&&(e.className=(e.className?(e.className+" ").replace(p," "):"")+t)}function o(e,t){for(var a=" "+e.className+" ";a.indexOf(" "+t+" ")>-1;)a=a.replace(" "+t+" "," ");e.className=l(a)}function c(e,t){return 1===e.nodeType&&(" "+e.className+" ").replace(p," ").indexOf(" "+t+" ")>-1}function l(e){return null==e?"":(e+"").replace(m,"")}var u=function(){function e(t){var a=this;_classCallCheck(this,e),this.audio=new Audio,this.audio.preload="none",this.audio.src=t.src,this.audio.volume=1,this.duration=t.duration,this.repeating=!1,this.complete=t.complete,this.audio.addEventListener("ended",function(){a.repeating?(a.currentTime=0,a.play()):a.complete()},!1)}return _prototypeProperties(e,null,{play:{value:function(){return this.audio.play(),this},writable:!0,configurable:!0},pause:{value:function(){return this.audio.pause(),this},writable:!0,configurable:!0},stop:{value:function(){return this.pause(),this.audio.currentTime=0,this},writable:!0,configurable:!0}}),e}(),d=function(){function t(e){_classCallCheck(this,t),this.player=e.player,this.lessonId=e.lessonId,this.weChat=e.weChat||i,this.complete=e.complete,this.playbackComplete=e.playbackComplete,this.init()}return _prototypeProperties(t,null,{init:{value:function(){var e=this;this.weChat.onVoiceRecordEnd({complete:function(t){e.lastTrack=t.localId,e.complete(t)}}),this.weChat.onVoicePlayEnd({success:function(){e.playbackComplete()}})},writable:!0,configurable:!0},record:{value:function(){this.player.vm.recordLength=0,this.recordLength=0,this.weChat.startRecord(),this.startTime=(new Date).getTime(),this.updateTime()},writable:!0,configurable:!0},updateTime:{value:function(){var e=this,t=200;e.refreshTimeout=setTimeout(function a(){e.recordLength=((new Date).getTime()-e.startTime)/1e3,e.player.vm.recordLength=Math.round(e.recordLength),e.refreshTimeout=setTimeout(a,t)},t)},writable:!0,configurable:!0},stop:{value:function(e){var t=this;clearTimeout(this.refreshTimeout),this.weChat.stopRecord({success:function(a){t.lastTrack=a.localId,(e||t.complete)(a)}})},writable:!0,configurable:!0},playback:{value:function(){this.lastTrack&&this.weChat.playVoice({localId:this.lastTrack})},writable:!0,configurable:!0},pausePlayback:{value:function(e){this.lastTrack&&(this.weChat.pauseVoice({localId:this.lastTrack}),e&&e())},writable:!0,configurable:!0},send:{value:function(t){var a=this;this.lastTrack&&this.weChat.uploadVoice({localId:this.lastTrack,success:function(i){var n=new FormData,r=new XMLHttpRequest;n.append("lesson_guid",a.lessonId),n.append("media_id",i.serverId),r.onreadystatechange=function(){4==r.readyState&&(t(JSON.parse(r.responseText)),e.alert(200==r.status?"录音上传成功！":"上传失败，请稍后再试"))},r.open("POST","/reading/save"),r.send(n)}})},writable:!0,configurable:!0}}),t}(),h=function(){function a(){var e=this;_classCallCheck(this,a),this.lessonId=t.querySelector("#player").dataset.lessonid,this.gramophone=new u(r({},t.querySelector("[data-play]").dataset,{complete:function(){return e.vm.status="standingBy"}})),this.recorder=new d({player:this,lessonId:this.lessonId,complete:function(){e.vm.stoppingRecord=!1,e.vm.status="recorded"},playbackComplete:function(){return e.vm.trackPlaying=!1},weChat:i}),this.initControls()}return _prototypeProperties(a,null,{initControls:{value:function(){var t=this,a=0;this.vm=new n({el:"#player",data:{status:"initiating",repeating:!1,trackPlaying:!1,recordTime:"00:00:00",stoppingRecord:!1,sendingRecord:!1},computed:{recordLength:{get:function(){return a},set:function(e){return t.vm.recordTime="number"==typeof e?[t.lowerDigits(parseInt(e/3600),2),t.lowerDigits(parseInt(e%3600/60),2),t.lowerDigits(Math.round(e%60),2)].join(":"):e,a=e}}},methods:{playClick:function(){switch(this.status){case"standingBy":case"paused":t.gramophone.play(),this.status="playing";break;case"playing":t.gramophone.pause(),this.status="paused"}},stopClick:function(){"initiating"!==this.status&&(t.gramophone.stop(),this.status="standingBy")},repeatClick:function(){t.gramophone.repeating=this.repeating=!this.repeating},recordClick:function(){var e=this;switch(this.status){case"standingBy":t.recorder.record(),this.status="recording";break;case"recording":this.stoppingRecord||(this.stoppingRecord=!0,t.recorder.stop());break;case"recorded":this.sendingRecord||(this.sendingRecord=!0,t.recorder.send(function(){e.sendingRecord=!1,e.status="standingBy"}))}},cancelClick:function(){var a=this;if(!this.sendingRecord){switch(this.status){case"recording":this.stoppingRecord||(this.stopRecord=!0,t.recorder.stop(function(){t.recorder.lastTrack=null,a.stopRecord=!1,a.status="standingBy"}));break;case"recorded":e.confirm("确定要放弃之前的录音？")&&(t.recorder.lastTrack=null,this.status="standingBy",this.trackPlaying&&(t.recorder.pausePlayback(),this.trackPlaying=!1))}this.status="standingBy"}},redoClick:function(){this.sendingRecord||(this.trackPlaying&&(t.pausePlayback(),this.trackPlaying=!1),t.recorder.lastTrack=null,t.recorder.record(),this.status="recording")},trackPlayClick:function(){try{this.sendingRecord||(this.trackPlaying?t.recorder.pausePlayback():t.recorder.playback(),this.trackPlaying=!this.trackPlaying)}catch(e){alert(e)}}}})},writable:!0,configurable:!0},lowerDigits:{value:function(e,t){for(var a="",i=0;t>i;i++)a+="0";return(0>e?"-":"")+(a+(Math.abs(e)||0)).slice(-t)},writable:!0,configurable:!0}}),a}(),p=/[\t\r\n\f]/g,m=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;e.weChatConfig&&(e.weChatConfig({jsApiList:["showMenuItems","hideMenuItems","onMenuShareTimeline","onMenuShareAppMessage","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","onVoicePlayEnd","uploadVoice"]}),i.ready(function(){i.showMenuItems({menuList:["menuItem:share:appMessage","menuItem:share:timeline","menuItem:favorite","menuItem:copyUrl"]}),i.hideMenuItems({menuList:["menuItem:share:qq","menuItem:share:weiboApp","menuItem:share:facebook","menuItem:share:QZone","menuItem:originPage","menuItem:readMode","menuItem:openWithQQBrowser","menuItem:openWithSafari","menuItem:share:email","menuItem:share:brand"]});var a=t.querySelector("[data-wxshare]").dataset;i.onMenuShareTimeline({title:a.title,link:e.location.href,imgUrl:a.image}),i.onMenuShareAppMessage({title:a.title,desc:a.description,link:e.location.href,imgUrl:a.image});var n=new h;n.vm.status="standingBy";var r=t.querySelector(".iconStar"),l="iconStarred",u=!1;r.addEventListener("click",function(){var t=c(r,l);u||!function(){var a=new XMLHttpRequest;u=!0,a.onreadystatechange=function(){if(4==a.readyState){if(200==a.status){var i=JSON.parse(a.responseText);1e4==i.msgcode?t?o(r,l):s(r,l,!0):e.alert(i.message)}else e.alert("修改收藏失败，请稍后再试");u=!1}},alert(t?"/unLike":"/like"),a.open("POST","/rest/v1/lesson/"+n.lessonId+(t?"/unLike":"/like")),a.send()}()},!1)}))}(window,document,navigator,wx,Vue);
//# sourceMappingURL=/assets/scripts/article.js.map